# 身份认证

> 通过一定的手段,完成对用户身份的确认 

## 不同开发模式的身份验证

1. 如果是服务器端渲染,推荐使用`session`认证机制
2. 前后端分离推荐使用`JWT`认证机制

## Session认证机制

### HTTP协议的无状态性

> 客户端每次HTTP请求都是独立的,连续多个请求之间没有直接的关系,服务器不会主动保留每次HTTP请求的状态

### 如何突破HTTP的无状态的限制

> 给予Cookie来验证身份

### Cookie

> Cookie是存储在用户浏览器中的一段不超过4kb的字符串,它由一个名称(name),一个value和其他用于控制Cookie`有效期,安全性,使用范围`的可选属性组成

1. 不同域名下的Cookie各自独立,每当客户端发起请求时,会自动把当前域名下所有未过期的Cookie以同发送到服务器
2. 特性:
   1. 自动发送
   2. 域名独立
   3. 过期时限
   4. 4kb限制

### Cookie的作用

1. 客户端第一请求服务器的时候,服务器通过响应头的形式,向客户端发送一个身份认证的Cookie,客户端自动将Cookie存储在浏览器中
2. 随后 每当客户端浏览器每次请求服务器的时候,浏览器会自动将身份认证相关的Cookie,==通过请求头的形式==发送给服务器,服务器即可验明客户端的身份

### Cookie不具有安全性

> 因为Cookie是可以在浏览器中可以修改的

### 提高身份认证的安全性

> 使用session,光验证Cookie还不行,必须要确认这是从我这边一开始发出去的Cookie,双重验证提高保障

### Seesion的工作原理

![image-20210722205636440](https://gitee.com/IU_czx/images/raw/master/img/image-20210722205636440.png)

1. cookie与用户信息是对应的
2. 浏览器发起请求,把存储当下的cookie发送给后端验证

## jwt的认证机制

### 了解Session认证的局限性

> Session认证机制需要配合Cookie才能实现,由于Cookie默认不支持跨域访问,所以,当涉及到前端跨域请求后端接口的时候,需要做很多额外的配置,才能实现Session认证

==注意==

1. 涉及到跨域请求的时候,使用`jwt`
2. 不涉及到跨域请求的时候,使用session

### jwt的含义

> JWT(JSON Web Token) 是目前最流行的跨域认证解决方法

### JWT的工作原理

用户的信息通过Token字符串的形式,保存在客户端浏览器中.服务器还原Token字符串来验证身份

### jwt的组成部分

由Header,PayLoad(负荷),Signatrue

* PayLoad才是真正的用户信息
* 其余两个是保障Token的安全性

### jwt的使用方法

> 他通常会存储在localStorage或sessionStorage中

1. 首先引入两个包
   1. jsonwebtoken用于生成jwt的字符串
   2. express-jwt用于将jwt字符串解析还原JSON对象

## 数据验证的原则

表单验证的原则:前端验证为辅,后端验证为主,后端永远不要相信前端提交过来的内容

1. 安装@hapi/joi包---------为表单中携带的每个数据项,定义验证规则

2. 安装@escook/express-joi 来实现自动对表单数据进行验证的功能

   

